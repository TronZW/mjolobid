{% extends 'base.html' %}

{% block title %}Register - MjoloBid{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-4xl mx-auto">
        <!-- Django Messages - Display at the top -->
        {% if messages %}
            <div class="mb-6 space-y-3">
                {% for message in messages %}
                    <div class="p-4 rounded-xl border-2 {% if message.tags == 'error' %}bg-red-50 border-red-300 text-red-900{% elif message.tags == 'success' %}bg-green-50 border-green-300 text-green-900{% elif message.tags == 'warning' %}bg-yellow-50 border-yellow-300 text-yellow-900{% else %}bg-blue-50 border-blue-300 text-blue-900{% endif %} animate-pulse">
                        <div class="flex items-center">
                            <i class="fas {% if message.tags == 'error' %}fa-exclamation-triangle{% elif message.tags == 'success' %}fa-check-circle{% elif message.tags == 'warning' %}fa-exclamation-circle{% else %}fa-info-circle{% endif %} mr-3 text-lg"></i>
                            <span class="font-semibold">{{ message }}</span>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="mx-auto h-16 w-16 bg-gradient-to-r from-primary to-secondary rounded-full flex items-center justify-center mb-4">
                <i class="fas fa-heart text-white text-2xl"></i>
            </div>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Join MjoloBid</h1>
            <p class="text-gray-600">Create your account and start connecting for amazing social events</p>
        </div>

        <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
            <form method="POST" enctype="multipart/form-data" class="p-8">
                {% csrf_token %}
                {% if form.non_field_errors %}
                <div class="mb-6 text-red-600 text-sm flex items-center">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    {{ form.non_field_errors.0 }}
                </div>
                {% endif %}
                
                <!-- User Type Selection -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                        <i class="fas fa-user-tag mr-2 text-primary"></i>I am a:
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <label for="user_type_m" class="relative flex items-center p-6 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-primary hover:bg-purple-50 transition-all duration-200 group select-none">
                            <input type="radio" id="user_type_m" name="user_type" value="M" class="absolute inset-0 opacity-0 cursor-pointer" required>
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center group-hover:bg-blue-200 transition-colors">
                                    <i class="fas fa-male text-blue-600 text-xl"></i>
                                </div>
                                <div>
                                    <div class="font-semibold text-gray-900">Male</div>
                                    <div class="text-sm text-gray-600">Post bids for events</div>
                                </div>
                            </div>
                            <div class="absolute top-2 right-2 w-6 h-6 border-2 border-gray-300 rounded-full group-hover:border-primary transition-colors"></div>
                        </label>
                        
                        <label for="user_type_f" class="relative flex items-center p-6 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-primary hover:bg-pink-50 transition-all duration-200 group select-none">
                            <input type="radio" id="user_type_f" name="user_type" value="F" class="absolute inset-0 opacity-0 cursor-pointer" required>
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-pink-100 rounded-full flex items-center justify-center group-hover:bg-pink-200 transition-colors">
                                    <i class="fas fa-female text-pink-600 text-xl"></i>
                                </div>
                                <div>
                                    <div class="font-semibold text-gray-900">Female</div>
                                    <div class="text-sm text-gray-600">Browse and accept bids</div>
                                </div>
                            </div>
                            <div class="absolute top-2 right-2 w-6 h-6 border-2 border-gray-300 rounded-full group-hover:border-primary transition-colors"></div>
                        </label>
                    </div>
                    {% if form.user_type.errors %}
                        <div class="text-red-600 text-sm flex items-center mt-2">
                            <i class="fas fa-exclamation-circle mr-1"></i>
                            {{ form.user_type.errors.0 }}
                        </div>
                    {% endif %}
                </div>

                
                
                <!-- Basic Information -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                        <i class="fas fa-user mr-2 text-primary"></i>Basic Information
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label for="{{ form.username.id_for_label }}" class="block text-sm font-semibold text-gray-700">
                                Username *
                            </label>
                            <input type="text" 
                                   name="{{ form.username.name }}" 
                                   id="{{ form.username.id_for_label }}"
                                   value="{{ form.username.value|default:'' }}"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"
                                   placeholder="Choose a unique username"
                                   required>
                            {% if form.username.errors %}
                                <div class="text-red-600 text-sm flex items-center">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ form.username.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="space-y-2">
                            <label for="{{ form.email.id_for_label }}" class="block text-sm font-semibold text-gray-700">
                                Email Address *
                            </label>
                            <input type="email" 
                                   name="{{ form.email.name }}" 
                                   id="{{ form.email.id_for_label }}"
                                   value="{{ form.email.value|default:'' }}"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"
                                   placeholder="your.email@example.com"
                                   required>
                            {% if form.email.errors %}
                                <div class="text-red-600 text-sm flex items-center">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ form.email.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Password Section -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                        <i class="fas fa-lock mr-2 text-primary"></i>Password
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label for="{{ form.password1.id_for_label }}" class="block text-sm font-semibold text-gray-700">
                                Password *
                            </label>
                            <div class="relative">
                                <input type="password" 
                                       name="{{ form.password1.name }}" 
                                       id="{{ form.password1.id_for_label }}"
                                       class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"
                                       placeholder="Create a strong password"
                                       required>
                                <button type="button" 
                                        class="absolute inset-y-0 right-0 pr-4 flex items-center"
                                        onclick="togglePassword('{{ form.password1.id_for_label }}')">
                                    <i class="fas fa-eye text-gray-400 hover:text-gray-600"></i>
                                </button>
                            </div>
                            {% if form.password1.errors %}
                                <div class="text-red-600 text-sm flex items-center">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ form.password1.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="space-y-2">
                            <label for="{{ form.password2.id_for_label }}" class="block text-sm font-semibold text-gray-700">
                                Confirm Password *
                            </label>
                            <div class="relative">
                                <input type="password" 
                                       name="{{ form.password2.name }}" 
                                       id="{{ form.password2.id_for_label }}"
                                       class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"
                                       placeholder="Confirm your password"
                                       required>
                                <button type="button" 
                                        class="absolute inset-y-0 right-0 pr-4 flex items-center"
                                        onclick="togglePassword('{{ form.password2.id_for_label }}')">
                                    <i class="fas fa-eye text-gray-400 hover:text-gray-600"></i>
                                </button>
                            </div>
                            {% if form.password2.errors %}
                                <div class="text-red-600 text-sm flex items-center">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ form.password2.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Personal Details -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                        <i class="fas fa-id-card mr-2 text-primary"></i>Personal Details
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label for="{{ form.phone_number.id_for_label }}" class="block text-sm font-semibold text-gray-700">
                                Phone Number *
                            </label>
                            <input type="tel" 
                                   name="{{ form.phone_number.name }}" 
                                   id="{{ form.phone_number.id_for_label }}"
                                   value="{{ form.phone_number.value|default:'' }}"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"
                                   placeholder="+263 XXX XXX XXX"
                                   required>
                            {% if form.phone_number.errors %}
                                <div class="text-red-600 text-sm flex items-center">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ form.phone_number.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="space-y-2">
                            <label for="{{ form.date_of_birth.id_for_label }}" class="block text-sm font-semibold text-gray-700">
                                Date of Birth *
                            </label>
                            <input type="date" 
                                   name="{{ form.date_of_birth.name }}" 
                                   id="{{ form.date_of_birth.id_for_label }}"
                                   value="{{ form.date_of_birth.value|default:'' }}"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"
                                   required>
                            {% if form.date_of_birth.errors %}
                                <div class="text-red-600 text-sm flex items-center">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ form.date_of_birth.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="mt-6 space-y-2">
                        <label for="{{ form.city.id_for_label }}" class="block text-sm font-semibold text-gray-700">
                            City *
                        </label>
                        <input type="text" 
                               name="{{ form.city.name }}" 
                               id="{{ form.city.id_for_label }}"
                               value="{{ form.city.value|default:'' }}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"
                               placeholder="Harare, Bulawayo, etc."
                               required>
                        {% if form.city.errors %}
                            <div class="text-red-600 text-sm flex items-center">
                                <i class="fas fa-exclamation-circle mr-1"></i>
                                {{ form.city.errors.0 }}
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Profile Section -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                        <i class="fas fa-user-circle mr-2 text-primary"></i>Profile
                    </h3>
                    
                    <div class="space-y-6">
                        <div class="space-y-2">
                            <label for="{{ form.bio.id_for_label }}" class="block text-sm font-semibold text-gray-700">
                                Bio (Optional)
                            </label>
                            <textarea name="{{ form.bio.name }}" 
                                      id="{{ form.bio.id_for_label }}"
                                      rows="3"
                                      class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200 resize-none"
                                      placeholder="Tell us a bit about yourself...">{{ form.bio.value|default:'' }}</textarea>
                            {% if form.bio.errors %}
                                <div class="text-red-600 text-sm flex items-center">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ form.bio.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="space-y-2">
                            <label for="{{ form.profile_picture.id_for_label }}" class="block text-sm font-semibold text-gray-700">
                                Profile Picture (Optional)
                            </label>
                            <div class="flex items-center space-x-4">
                                <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center border-2 border-dashed border-gray-300">
                                    <i class="fas fa-camera text-gray-400"></i>
                                </div>
                                <div class="flex-1">
                                    <input type="file" 
                                           name="{{ form.profile_picture.name }}" 
                                           id="{{ form.profile_picture.id_for_label }}"
                                           accept="image/*"
                                           class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-purple-700">
                                    <p class="text-xs text-gray-500 mt-1">JPG, PNG or GIF. Max size 5MB.</p>
                                </div>
                            </div>
                            {% if form.profile_picture.errors %}
                                <div class="text-red-600 text-sm flex items-center">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ form.profile_picture.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Terms and Conditions -->
                <div class="mb-8">
                    <div class="flex items-start space-x-3">
                        <input id="terms" name="terms" type="checkbox" 
                               class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded mt-1" required>
                        <label for="terms" class="text-sm text-gray-700">
                            I agree to the <a href="#" class="text-primary hover:text-purple-700 font-semibold">Terms of Service</a> 
                            and <a href="#" class="text-primary hover:text-purple-700 font-semibold">Privacy Policy</a>
                        </label>
                    </div>
                </div>
                
                <!-- Submit Button -->
                <div class="flex justify-center">
                    <button type="submit" 
                            class="w-full md:w-auto bg-gradient-to-r from-primary to-secondary text-white py-4 px-8 rounded-xl font-semibold hover:shadow-lg hover:scale-[1.02] transform transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                        <i class="fas fa-user-plus mr-2"></i>Create My Account
                    </button>
                </div>
            </form>
            
            <!-- Footer -->
            <div class="bg-gray-50 px-8 py-6 border-t border-gray-200">
                <div class="text-center">
                    <p class="text-gray-600">
                        Already have an account? 
                        <a href="{% url 'accounts:login' %}" class="font-semibold text-primary hover:text-purple-700 transition-colors">
                            Sign in here
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function togglePassword(inputId) {
    const input = document.getElementById(inputId);
    const icon = input.nextElementSibling.querySelector('i');
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

// Radio button selection styling
document.addEventListener('DOMContentLoaded', function() {
    // Gender selection styling and click support on entire label area
    const maleLabel = document.querySelector('label[for="user_type_m"]');
    const femaleLabel = document.querySelector('label[for="user_type_f"]');
    const maleRadio = document.getElementById('user_type_m');
    const femaleRadio = document.getElementById('user_type_f');

    function resetStyles() {
        [maleLabel, femaleLabel].forEach(l => {
            l.classList.remove('border-primary', 'bg-blue-50', 'bg-pink-50');
            l.classList.add('border-gray-200');
            const check = l.querySelector('.absolute');
            if (check) {
                check.classList.remove('bg-primary', 'border-primary');
                check.classList.add('border-gray-300');
            }
        });
    }

    function applyStyles(label, value) {
        label.classList.remove('border-gray-200');
        label.classList.add('border-primary');
        if (value === 'M') {
            label.classList.add('bg-blue-50');
        } else {
            label.classList.add('bg-pink-50');
        }
        const check = label.querySelector('.absolute');
        if (check) {
            check.classList.remove('border-gray-300');
            check.classList.add('bg-primary', 'border-primary');
        }
    }

    function handleChange(e) {
        resetStyles();
        if (maleRadio.checked) applyStyles(maleLabel, 'M');
        if (femaleRadio.checked) applyStyles(femaleLabel, 'F');
    }

    [maleLabel, femaleLabel].forEach(label => {
        label.addEventListener('click', function(e) {
            const input = this.querySelector('input[type="radio"]');
            if (input) {
                input.checked = true;
                handleChange();
            }
        });
    });

    maleRadio.addEventListener('change', handleChange);
    femaleRadio.addEventListener('change', handleChange);

    // Set max date for date of birth
    const dateInput = document.getElementById('{{ form.date_of_birth.id_for_label }}');
    const today = new Date();
    const maxDate = new Date(today.getFullYear() - 18, today.getMonth(), today.getDate());
    dateInput.max = maxDate.toISOString().split('T')[0];
    
    // Auto-scroll to messages if they exist
    const messagesContainer = document.querySelector('.space-y-3');
    if (messagesContainer && messagesContainer.children.length > 0) {
        setTimeout(function() {
            messagesContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
    }
});
</script>
{% endblock %}

